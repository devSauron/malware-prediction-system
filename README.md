# malware-prediction-system
__“With great power comes greater responsibility”__- Uncle Ben (Spider-man (Marvel Comics)<br/>
As we move into the future, we would have more and more advanced technologies in our hands but at the same time there would be a greater responsibility to save those machines from Malware Infections.

One of the first instance of Malware infection – <br/>
<img align="right" width="250" height="250" src="https://github.com/Team7-Code/malware-prediction-system/blob/master/Scripts/processing_scripts/images/Picture1.png">


### Data Source
This data is sourced from one of the ongoing Kaggle competitions. The telemetry data containing system properties and the machine infections was generated by combining heartbeat and threat reports collected by Microsoft's endpoint protection solution, Windows Defender.
### Data Characteristics
The collected data contains 8,921,483 records and 82 columns
Response variable is a binary encoded column, “HasDetections” with values 0 or 1
Missing values constitute 7.5% of the overall data.
### Process Overview
The below diagram shows the overall process flow of this project - <br/>
![Process Flow](https://github.com/Team7-Code/malware-prediction-system/blob/master/Scripts/processing_scripts/images/process_flow.png)

### Data Cleaning
##### Duplicates Check
* We did not find any duplicates in the dataset.
* Our dataset has a unique Machine Identifier which acts as the primary key.

##### Skewness Check
* Out of the 6 ratio column we had
  * Dropped column DisplaySize and BatteryNumberOfCharges based on high skewness data and domain knowledge
  * Skewed columns like PhysicalRAM, ProcessorCount were handled using Box-Cox Transformation
* PrimaryDiskCapacity with a very high skewness value of 1744.102, was handled as categorical data column using its 5736 discrete values
##### Missing Value Identification
DefaultBrowser, ProcessorClass, BatteryType and IsFlightingInternal columns were removed as the missing values were greater than 50%

__As part of Data Cleaning, we removed 7% of columns and transformed 6% of columns__

### Strategy
Imputing the data is a very challenging task as it requires a thorough understanding of the data and its features. <br/>
Out of 34 columns which had missing values, we devised the following steps for imputation – 
* 27 categorical columns with datatype integer/float, were imputed with -1
* 5 categorical columns of datatype object were imputed with “UNKNOWN” 
* 2 columns, where missing values were imputed with their mode
* Some columns with inconsistent values like spelling mistakes etc. were manually corrected

### Dimensionality Reduction
###### Multi Collinearity Analysis
We used Variation Inflation Factor (VIF) as a measure to check for multi-collinearity
* 15 columns, such as OSEdition, OsSuite, AppVersion etc. whose VIF value was greater than 4 were removed
* The plot shows the Log of VIF plotted with a green cut-off value
* The one’s highlighted in orange were selected for removal <br/>
![VIF Plot](https://github.com/Team7-Code/malware-prediction-system/blob/master/Scripts/processing_scripts/images/vif_output.png)

##### Chi Statistics Analysis
* We calculated the contribution of each column to the Chi Square value
* Features with p-value > 0.5 were selected for removal from the dataset
* We have plotted the Chi Stat value using this adjustment <br/>
𝐴𝑑𝑗 𝐶ℎ𝑖 𝑆𝑡𝑎𝑡= 〖𝑙𝑜𝑔〗_𝑒 (abs(𝐶ℎ𝑖 𝑆𝑡𝑎𝑡))
* The one’s highlighted in orange were selected for removal <br/>
![Chi Stat](https://github.com/Team7-Code/malware-prediction-system/blob/master/Scripts/processing_scripts/images/chi_stat.jpg)

###### Principle Component Analysis (PCA)
* Based on the plot for 2 PCA components and the variance percentages, we can only conclude that PC1 and PC2 are the main components but altogether they can only explain 49.8% of variance.<br/>
* The plot on the right is also not reliable as the points are in between the two PC axes.<br/>
__Therefore, PCA in this case is not reliable!__<br/>
![PCA](https://github.com/Team7-Code/malware-prediction-system/blob/master/Scripts/processing_scripts/images/pca_output.png)

##### Random Forest
![RF](https://github.com/Team7-Code/malware-prediction-system/blob/master/Scripts/processing_scripts/images/rf_1.png)

##### Market Basket Analysis
For this analysis, we only take those records which were affiliated with a “positive” malware infection, i.e. 124,570 records.<br/>
Thresholds: <br/>
* Considering only 3, 4 and 5-frequent item-sets.
* Support > 20% 
* Lift > 1 (features selected have a minimum lift of 2.03) <br/>
__Important Features__<br/>
![Market Basket](https://github.com/Team7-Code/malware-prediction-system/blob/master/Scripts/processing_scripts/images/market_bask_important_features.png)

##### Final Dimensionality Reduction Result
![Market Basket](https://github.com/Team7-Code/malware-prediction-system/blob/master/Scripts/processing_scripts/images/market_basket_result.png)

##### Market Basket Analysis – Interesting Facts
Frequent itemset analysis always leads to some awesome facts about the data. The following machine characteristics can be marked as more susceptible to malware infection – 
* Machines without a portable OS
* Some anti-virus products are in-affective in preventing malware infection
* AMD64 OS architectures are more prone to malware infection
* OS version of 10.0.0.0 and build version 17134 and 16299
* x64 Processors
* Machines with Optical Disk Drives and with HDD primary disk types
* An unknown and “require admin” permission for SmartScreen status
* Machines without an enabled WIM boot
* Non-gamer machines are 7 times more susceptible to infection than the gamer ones
* Machines in region identifier 10 (anonymized geographical region) are the ones which get infected the most

### Data Modelling and Results
![Logistic Reg](https://github.com/Team7-Code/malware-prediction-system/blob/master/Scripts/processing_scripts/images/lr.png)
![Lasso Reg](https://github.com/Team7-Code/malware-prediction-system/blob/master/Scripts/processing_scripts/images/lasso.png)
![Ridge Reg](https://github.com/Team7-Code/malware-prediction-system/blob/master/Scripts/processing_scripts/images/ridge.png)

### Conclusion and Business Answers
* Identification of crucial features which would result in a malware infection. <br/>
*The 45 crucial features have been mentioned earlier from the dataset and other important features which were found to be prevalent in malware affected machines has been discussed and plotted earlier.*
* Does an antivirus product really prevent a machine from getting infected by a malware?<br/>
*From the dataset, we observe that machines which had anti-virus installed were the ones which got infected the most (especially the ones installed with Antivirus product anonymized as 2)*
* Are gamers more susceptible to malware infection?<br/>
*No, gamers are the ones which are least susceptible to malware infection. Non-gamers are 7 times more susceptible to malware infection than the gamer machines.*
* Does the genuineness of the operating system somehow prevent a malware infection?<br/>
*No, the genuineness of an OS does not always prevent malware infection, even the legit OS build versions have been found to be highly susceptible to malware infection as any other machine.*
